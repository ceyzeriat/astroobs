<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>astroobs.Observatory &mdash; astroobs  documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="astroobs  documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">astroobs  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for astroobs.Observatory</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#</span>
<span class="c"># Copyright ASTROOBS (c) 2015-20016 Guillaume SCHWORER</span>
<span class="c"># </span>
<span class="c"># Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="c"># of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="c"># in the Software without restriction, including without limitation the rights</span>
<span class="c"># to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="c"># copies of the Software, and to permit persons to whom the Software is</span>
<span class="c"># furnished to do so, subject to the following conditions:</span>
<span class="c"># </span>
<span class="c"># The above copyright notice and this permission notice shall be included in</span>
<span class="c"># all copies or substantial portions of the Software.</span>
<span class="c"># </span>
<span class="c"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="c"># IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="c"># FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="c"># AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="c"># LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="c"># OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="c"># THE SOFTWARE.</span>
<span class="c"># </span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">_core</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">astroobsexception</span> <span class="k">as</span> <span class="n">_exc</span>

<span class="kn">from</span> <span class="nn">.ObservatoryList</span> <span class="kn">import</span> <span class="n">ObservatoryList</span>
<span class="kn">from</span> <span class="nn">.Moon</span> <span class="kn">import</span> <span class="n">Moon</span>

<div class="viewcode-block" id="Observatory"><a class="viewcode-back" href="../../docs/astroobs.html#astroobs.Observatory.Observatory">[docs]</a><span class="k">class</span> <span class="nc">Observatory</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">Observer</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines an observatory from which the ephemeris of the twilights or a night-sky target are processed. The *night-time* is base on the given date. It ends at the next sunrise and starts at the sunset preceeding this next sunrise.</span>

<span class="sd">    Args:</span>
<span class="sd">      * obs (str): id of the observatory to pick from the observatories database OR the name of the custom observatory (in that case, ``long``, ``lat``, ``elevation``, ``timezone`` must also be given, ``temp``, ``pressure``, ``moonAvoidRadius`` are optional)</span>
<span class="sd">      * local_date (see below): the date of observation in local time</span>
<span class="sd">      * ut_date (see below): the date of observation in UT time</span>
<span class="sd">      * horizon_obs (float - degrees): minimum altitude at which a target can be observed, default is 30 degrees altitude</span>
<span class="sd">      * epoch (str): the &#39;YYYY&#39; year in which all ra-dec coordinates are converted</span>

<span class="sd">    Kwargs:</span>
<span class="sd">      * raiseError (bool): if ``True``, errors will be raised; if ``False``, they will be printed. Default is ``False``</span>
<span class="sd">      * fig: TBD</span>

<span class="sd">    Raises:</span>
<span class="sd">      * NameError: if a mandatory input parameter is missing</span>
<span class="sd">      * KeyError: if the observatory ID does not exist</span>
<span class="sd">      * KeyError: if the twilight keyword is unknown</span>
<span class="sd">      * Exception: if the observatory object has no date</span>

<span class="sd">    .. note::</span>
<span class="sd">      * For details on ``local_date`` and ``ut_date``, refer to :func:`Observatory.upd_date`</span>
<span class="sd">      * For details on other input parameters, refer to :func:`ObservatoryList.add`</span>
<span class="sd">      * The :class:`Observatory` automatically creates and manages a :class:`Moon` target under ``moon`` attribute</span>
<span class="sd">      * If ``obs`` is the id of an observatory to pick in the database, the user can still provide ``temp``, ``pressure``, ``moonAvoidRadius`` attributes which will override the database default values</span>
<span class="sd">      * ``horizon`` attribute is in radian</span>

<span class="sd">    Main attributes:</span>
<span class="sd">      * ``localnight``: gives the local midnight time in local time (YYYY, MM, DD, 23, 59, 59)</span>
<span class="sd">      * ``date``: gives the local midnight time in UT time</span>
<span class="sd">      * ``dates``: is a vector of Dublin Julian Dates. Refer to :func:`process_obs`</span>
<span class="sd">      * ``lst``: the local sidereal time corresponding to each ``dates`` element</span>
<span class="sd">      * ``localTimeOffest``: gives the shift in days between UT and local time: local=UT+localTimeOffest</span>
<span class="sd">      * ``moon``: points to the :class:`Moon` target processed for the given observatory and date</span>
<span class="sd">    Twilight attributes:</span>
<span class="sd">      * For the next three attributes, ``XXX`` shall be replaced by {&#39;&#39; (blank), &#39;civil&#39;, &#39;nautical&#39;, &#39;astro&#39;} for, respectively, horizon, -6, -12, and -18 degrees altitude</span>
<span class="sd">      * ``sunriseXXX``: gives the sunrise time for different twilights, in Dublin Julian Dates. e.g.: ``observatory.sunrise``</span>
<span class="sd">      * ``sunsetXXX``: gives the sunset time for different twilights, in Dublin Julian Dates. e.g.: ``observatory.sunsetcivil``</span>
<span class="sd">      * ``len_nightXXX``: gives the night duration for different twilights (between corresponding sunset and sunrise), in hours. e.g.: ``observatory.len_nightnautical``</span>

<span class="sd">    .. warning::</span>
<span class="sd">      * it can occur that the Sun, the Moon or a target does not rise or set for an observatory/date combination. In that case, the corresponding attributes will be set to ``None``</span>

<span class="sd">    &gt;&gt;&gt; import astroobs.obs as obs</span>
<span class="sd">    &gt;&gt;&gt; o = obs.Observatory(&#39;ohp&#39;, local_date=(2015,3,31,23,59,59))</span>
<span class="sd">    &gt;&gt;&gt; o</span>
<span class="sd">    &lt;ephem.Observer date=&#39;2015/3/31 21:59:59&#39; epoch=&#39;2000/1/1 12:00:00&#39;</span>
<span class="sd">    lon=5:42:48.0 lat=43:55:51.0 elevation=650.0m horizon=-0:49:04.8</span>
<span class="sd">    temp=15.0C pressure=1010.0mBar&gt;</span>
<span class="sd">    &gt;&gt;&gt; o.moon</span>
<span class="sd">    Moon - phase: 89.2%</span>
<span class="sd">    &gt;&gt;&gt; print(o.sunset, &#39;...&#39;, o.sunrise, &#39;...&#39;, o.len_night)</span>
<span class="sd">    2015/3/31 18:08:40 ... 2015/4/1 05:13:09 ... 11.0746939826</span>
<span class="sd">    &gt;&gt;&gt; import ephem as E</span>
<span class="sd">    &gt;&gt;&gt; print(E.Date(o.sunsetastro+o.localTimeOffest), &#39;...&#39;, E.Date(</span>
<span class="sd">            o.sunriseastro+o.localTimeOffest), &#39;...&#39;, o.len_nightastro)</span>
<span class="sd">    2015/3/31 21:43:28 ... 2015/4/1 05:38:26 ... 7.91603336949</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="nb">long</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">elevation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">timezone</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pressure</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">moonAvoidRadius</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">local_date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ut_date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">horizon_obs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dataFile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="s">&#39;2000&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Observatory</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span> <span class="c"># first init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raiseError</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;raiseError&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">long</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">lat</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">elevation</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">timezone</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># gave directly an obsid, supposely</span>
            <span class="n">obslist</span> <span class="o">=</span> <span class="n">ObservatoryList</span><span class="p">(</span><span class="n">dataFile</span><span class="o">=</span><span class="n">dataFile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">obs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">obslist</span><span class="o">.</span><span class="n">obsids</span><span class="p">:</span> <span class="c"># if correct id</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obslist</span><span class="o">.</span><span class="n">obsdic</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="c"># copy the site info to self</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">obs</span>
            <span class="k">else</span><span class="p">:</span> <span class="c"># if not correct id</span>
                <span class="k">if</span> <span class="n">_exc</span><span class="o">.</span><span class="n">raiseIt</span><span class="p">(</span><span class="n">_exc</span><span class="o">.</span><span class="n">UnknownObservatory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raiseError</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span> <span class="k">return</span>
        <span class="k">elif</span> <span class="nb">long</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">lat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">elevation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">timezone</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># gave the details of a valid observatory</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">timezone</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elevation</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">elevation</span><span class="p">)</span>
            <span class="c"># checks the type of long and lat</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">long</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">long</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="nb">long</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">long</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="nb">long</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># a parameter is missing</span>
            <span class="k">if</span> <span class="n">_exc</span><span class="o">.</span><span class="n">raiseIt</span><span class="p">(</span><span class="n">_exc</span><span class="o">.</span><span class="n">UncompleteObservatory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raiseError</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span> <span class="k">return</span>
        <span class="c"># overwrite observatory value</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pressure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pressure</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">moonAvoidRadius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">moonAvoidRadius</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">moonAvoidRadius</span><span class="p">)</span>
        <span class="c"># checks if values exist and sets default if not</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;temp&#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp</span> <span class="o">=</span> <span class="mf">15.0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;pressure&#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span> <span class="o">=</span> <span class="mf">1010.0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;moonAvoidRadius&#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">moonAvoidRadius</span> <span class="o">=</span> <span class="mf">0.25</span>
        <span class="n">epoch</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">epoch</span><span class="p">))</span> <span class="c"># set epoch</span>
        <span class="k">if</span> <span class="n">epoch</span> <span class="o">==</span> <span class="s">&#39;2000&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">J2000</span>
        <span class="k">elif</span> <span class="n">epoch</span> <span class="o">==</span> <span class="s">&#39;1950&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">B1950</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span> <span class="o">=</span> <span class="n">epoch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="o">-</span><span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">elevation</span><span class="o">/</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">earth_radius</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">horizon_obs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">horizon_obs</span> <span class="o">=</span> <span class="mf">30.</span> <span class="c"># default value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">horizon_obs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">horizon_obs</span><span class="p">)</span>
        <span class="c"># initialise the date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upd_date</span><span class="p">(</span><span class="n">local_date</span><span class="o">=</span><span class="n">local_date</span><span class="p">,</span> <span class="n">ut_date</span><span class="o">=</span><span class="n">ut_date</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_calc_sunRiseSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes sunrise, sunset in UTC and night duration in hour and adds info to the object as attributes</span>
<span class="sd">        mode can be: &#39;&#39; (horizon), &#39;astro&#39; (-18 degrees), &#39;nautical&#39; (-12 degrees),&#39;civil&#39; (-6 degrees)</span>

<span class="sd">        assumption: self.date is local midnight of the observation date and is expressed in UT</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">horizs</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">,</span> <span class="s">&#39;astro&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">0.314159</span><span class="p">,</span> <span class="s">&#39;nautical&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">0.2094395</span><span class="p">,</span> <span class="s">&#39;civil&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">0.104719</span><span class="p">}</span> <span class="c"># 18, 12 and 6 degrees in radian</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">horizs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">_exc</span><span class="o">.</span><span class="n">raiseIt</span><span class="p">(</span><span class="n">_exc</span><span class="o">.</span><span class="n">UnknownTwilight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raiseError</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span> <span class="k">return</span>
        <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="c"># save initial obs values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="n">horizs</span><span class="p">[</span><span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="c"># set horizon from mode</span>
        <span class="c"># init in case of error</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;sunrise&quot;</span><span class="o">+</span><span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;sunset&quot;</span><span class="o">+</span><span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;len_night&quot;</span><span class="o">+</span><span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span> <span class="c"># try block to catch NeverUp or AlwaysUp errors from pyephem in case of polar region</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_rising</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">Sun</span><span class="p">())</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;sunrise&quot;</span><span class="o">+</span><span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">v</span><span class="p">)</span> <span class="c"># adds property sunrise of mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">v</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;sunset&quot;</span><span class="o">+</span><span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_setting</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">Sun</span><span class="p">()))</span> <span class="c"># adds property sunset of mode</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;len_night&quot;</span><span class="o">+</span><span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;sunrise&quot;</span><span class="o">+</span><span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">-</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;sunset&quot;</span><span class="o">+</span><span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span><span class="o">*</span><span class="mi">24</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">AlwaysUpError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alwaysDark</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">NeverUpError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alwaysDark</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="c"># restore initial obs values</span>


<div class="viewcode-block" id="Observatory.upd_date"><a class="viewcode-back" href="../../docs/astroobs.html#astroobs.Observatory.Observatory.upd_date">[docs]</a>    <span class="k">def</span> <span class="nf">upd_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ut_date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">local_date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the date of the observatory, and re-process the observatory parameters if the date is different.</span>

<span class="sd">        Args:</span>
<span class="sd">          * ut_date (see below): the date of observation in UT time</span>
<span class="sd">          * local_date (see below): the date of observation in local time</span>
<span class="sd">          * force (bool): if ``False``, the observatory is re-processed only if the date changed</span>

<span class="sd">        Kwargs:</span>
<span class="sd">          See class constructor</span>

<span class="sd">        Raises:</span>
<span class="sd">          * KeyError: if the twilight keyword is unknown</span>
<span class="sd">          * Exception: if the observatory object has no date</span>

<span class="sd">        Returns:</span>
<span class="sd">          ``True`` if the date was changed, otherwise ``False``</span>

<span class="sd">        .. note::</span>
<span class="sd">          * ``local_date`` and ``ut_date`` can be date-tuples ``(yyyy, mm, dd, [hh, mm, ss])``, timestamps, datetime structures or ephem.Date instances.</span>
<span class="sd">          * If both are given, ``ut_date`` has higher priority</span>
<span class="sd">          * If neither of those are given, the date is automatically set to *tonight* or *now* (whether the sun has already set or not)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stored_date</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;localnight&#39;</span><span class="p">,</span> <span class="n">_core</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="c"># saves initiprocess_obsal date value</span>
        <span class="c"># set the local_date to this night&#39;s sunset time in local time so we can get the local day/month/year</span>
        <span class="k">if</span> <span class="n">local_date</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">ut_date</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># default set to tonight midnight if date not provided</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="c"># takes the now for temporary calculation</span>
            <span class="k">try</span><span class="p">:</span> <span class="c"># are we in a polar region ?</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_rising</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">Sun</span><span class="p">()))</span>
                <span class="n">local_date</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">convertTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">previous_setting</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">Sun</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">,</span> <span class="s">&#39;utc&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;dt&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">AlwaysUpError</span><span class="p">,</span> <span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">NeverUpError</span><span class="p">):</span> <span class="c"># yes sire</span>
                <span class="k">if</span> <span class="n">_core</span><span class="o">.</span><span class="n">convertTime</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">,</span> <span class="s">&#39;utc&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;dt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">hour</span><span class="o">&lt;</span><span class="mi">12</span><span class="p">:</span> <span class="c"># yest</span>
                    <span class="n">local_date</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">convertTime</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">,</span> <span class="s">&#39;utc&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;ed&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span> <span class="c"># today</span>
                    <span class="n">local_date</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">convertTime</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">,</span> <span class="s">&#39;utc&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;dt&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ut_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># if given ut date</span>
            <span class="n">local_date</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">convertTime</span><span class="p">(</span><span class="n">ut_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">,</span> <span class="s">&#39;utc&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;dt&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># if given local date</span>
            <span class="n">local_date</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">cleanTime</span><span class="p">(</span><span class="n">local_date</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;dt&#39;</span><span class="p">)</span>
        <span class="c"># check if the date has changed</span>
        <span class="k">if</span> <span class="n">stored_date</span><span class="o">.</span><span class="n">year</span><span class="o">==</span><span class="n">local_date</span><span class="o">.</span><span class="n">year</span> <span class="ow">and</span> <span class="n">stored_date</span><span class="o">.</span><span class="n">month</span><span class="o">==</span><span class="n">local_date</span><span class="o">.</span><span class="n">month</span> <span class="ow">and</span> <span class="n">stored_date</span><span class="o">.</span><span class="n">day</span><span class="o">==</span><span class="n">local_date</span><span class="o">.</span><span class="n">day</span> <span class="ow">and</span> <span class="n">force</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span> <span class="c"># didn&#39;t change</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">s1</span> <span class="c"># set initial value back</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># the date has changed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">localTimeOffest</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">convertTime</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">,</span> <span class="s">&#39;utc&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;ed&#39;</span><span class="p">)</span><span class="o">-</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">localnight</span> <span class="o">=</span> <span class="n">local_date</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">59</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">59</span><span class="p">)</span> <span class="c"># midnight in local time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">convertTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">localnight</span><span class="p">,</span> <span class="s">&#39;utc&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;ed&#39;</span><span class="p">)</span> <span class="c"># midnight in UT time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_obs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="Observatory.process_obs"><a class="viewcode-back" href="../../docs/astroobs.html#astroobs.Observatory.Observatory.process_obs">[docs]</a>    <span class="k">def</span> <span class="nf">process_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">fullhour</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes all twilights as well as moon rise, set and position through night for the given observatory and date.</span>
<span class="sd">        Creates the vector ``observatory.dates`` which is the vector containing all timestamps at which the moon and the targets will be processed.</span>

<span class="sd">        Args:</span>
<span class="sd">          * pts (int) [optional]: the size of the ``dates`` vector, whose elements are linearly spaced in time</span>
<span class="sd">          * margin (float - minutes) [optional]: the margin between the first element of the vector ``dates`` and the sunset, and between the sunrise and its last element</span>
<span class="sd">          * fullhour (bool) [optional]: if ``True``, then the vector ``dates`` will start and finish on the first full hour preceeding sunset and following sunrise</span>

<span class="sd">        Kwargs:</span>
<span class="sd">          See class constructor</span>

<span class="sd">        Raises:</span>
<span class="sd">          * KeyError: if the twilight keyword is unknown</span>
<span class="sd">          * Exception: if the observatory object has no date</span>

<span class="sd">        .. note::</span>
<span class="sd">          In case the observatory is in polar regions where the sun does not alway set and rise everyday, the first and last elements of the ``dates`` vector are set to local midday right before and after the local midnight of the observation date. e.g.: 24h night centered on the local midnight.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">set_data_range</span><span class="p">(</span><span class="n">sunset</span><span class="p">,</span> <span class="n">sunrise</span><span class="p">,</span> <span class="n">numdates</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">fullhour</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Returns a numpy array of numdates dates linearly spaced in time, from margin minutes before sunset to margin minutes after sunrise if fullhour is False, and from the previous full hour before sunset to next full hour after sunrise if fullhour is True.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">fullhour</span><span class="p">:</span>
                <span class="n">ss</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sunset</span><span class="o">*</span><span class="mi">24</span><span class="p">)</span><span class="o">/</span><span class="mf">24.</span><span class="p">)</span>
                <span class="n">sr</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sunrise</span><span class="o">*</span><span class="mi">24</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">24.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ss</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sunset</span><span class="p">)</span> <span class="o">-</span> <span class="n">margin</span><span class="o">*</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span>
                <span class="n">sr</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sunrise</span><span class="p">)</span> <span class="o">+</span> <span class="n">margin</span><span class="o">*</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">numdates</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;date&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">_exc</span><span class="o">.</span><span class="n">raiseIt</span><span class="p">(</span><span class="n">_exc</span><span class="o">.</span><span class="n">NoObservatoryDate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raiseError</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span> <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">cleanTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;ed&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;astro&#39;</span><span class="p">,</span><span class="s">&#39;nautical&#39;</span><span class="p">,</span><span class="s">&#39;civil&#39;</span><span class="p">]:</span> <span class="c"># gets sunrise and sunsets for all modes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sunRiseSet</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunrise</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dates</span> <span class="o">=</span> <span class="n">set_data_range</span><span class="p">(</span><span class="n">sunset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sunset</span><span class="p">,</span> <span class="n">sunrise</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sunrise</span><span class="p">,</span> <span class="n">numdates</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">,</span> <span class="n">fullhour</span><span class="o">=</span><span class="n">fullhour</span><span class="p">)</span> <span class="c"># gets linearly spaced dates along the night</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># no sunrise or sunset, observatory in polar regions</span>
            <span class="n">startnight</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">convertTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">localnight</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="s">&#39;utc&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;ed&#39;</span><span class="p">)</span>
            <span class="n">endnight</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">convertTime</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">localnight</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">59</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">59</span><span class="p">),</span> <span class="s">&#39;utc&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;ed&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dates</span> <span class="o">=</span> <span class="n">set_data_range</span><span class="p">(</span><span class="n">sunset</span><span class="o">=</span><span class="n">startnight</span><span class="p">,</span> <span class="n">sunrise</span><span class="o">=</span><span class="n">endnight</span><span class="p">,</span> <span class="n">numdates</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fullhour</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="c"># gets linearly spaced dates along the night</span>
        <span class="c"># computes the lst</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">d</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sidereal_time</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lst</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lst</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="o">/</span><span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="c"># get radians to hours</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">s1</span>
        <span class="c"># computes the Moon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">moon</span> <span class="o">=</span> <span class="n">Moon</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nowArg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the index of *now* in the ``observatory.dates`` vector, or None if *now* is out of its bounds (meaning the observation is not taking place now)</span>

<span class="sd">        &gt;&gt;&gt; import astroobs.obs as obs</span>
<span class="sd">        &gt;&gt;&gt; import ephem as E</span>
<span class="sd">        &gt;&gt;&gt; o = obs.Observatory(&#39;ohp&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.plot(o.dates, o.moon.alt, &#39;k-&#39;)</span>
<span class="sd">        &gt;&gt;&gt; now = o.nowArg</span>
<span class="sd">        &gt;&gt;&gt; if now is not None:</span>
<span class="sd">        &gt;&gt;&gt;     plt.plot(o.dates[now], o.moon.alt[now], &#39;ro&#39;)</span>
<span class="sd">        &gt;&gt;&gt; else:</span>
<span class="sd">        &gt;&gt;&gt;     plt.plot([E.now(), E.now()], [o.moon.alt.min(),o.moon.alt.max()], &#39;r--&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">deltadates</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
        <span class="k">if</span> <span class="n">now</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">deltadates</span> <span class="ow">or</span> <span class="n">now</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">deltadates</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="o">-</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">now</span><span class="p">()))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
    <span class="nd">@nowArg.setter</span>
    <span class="k">def</span> <span class="nf">nowArg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_exc</span><span class="o">.</span><span class="n">raiseIt</span><span class="p">(</span><span class="n">_exc</span><span class="o">.</span><span class="n">ReadOnly</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raiseError</span><span class="p">,</span> <span class="s">&quot;nowArg&quot;</span><span class="p">):</span> <span class="k">return</span>


<div class="viewcode-block" id="Observatory.plot"><a class="viewcode-back" href="../../docs/astroobs.html#astroobs.Observatory.Observatory.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the observatory diagram</span>

<span class="sd">        Kwargs:</span>
<span class="sd">          * See class constructor</span>
<span class="sd">          * dt (float - hour): the spacing of x-axis labels, default is 1 hour (not with polar mode)</span>
<span class="sd">          * t0 (float - DJD or [0-24]): the date of the first tick-label of x-axis, default is sunsetastro. The time type must correspond to ``time`` parameter (not with polar mode)</span>
<span class="sd">          * xlim ([xmin, xmax]): bounds for x-axis, default is full night span (not with polar mode)</span>
<span class="sd">          * retxdisp (bool): if ``True``, bounds of x-axis displayed values are returned (``xdisp`` key)</span>
<span class="sd">          * ylim ([ymin, ymax]): bounds for y-axis, default is [horizon_obs-10, 90] (not with polar mode)</span>
<span class="sd">          * xlabel (str): label for x-axis, default &#39;Time (UT)&#39;</span>
<span class="sd">          * ylabel (str): label for y-axis, default &#39;Elevation ()&#39;</span>
<span class="sd">          * title (str): title of the diagram, default is observatory name or coordinates</span>
<span class="sd">          * ymin_margin (float): margin between xmin of graph and horizon_obs. Low priority vs ylim, default is 10 (not with polar mode)</span>
<span class="sd">          * retfignum (bool): if ``True``, the figure number will be returned, default is ``False``</span>
<span class="sd">          * fignum (int): figure number on which to plot, default is ``False``</span>
<span class="sd">          * retaxnum (bool): if ``True``, the ax index as in ``figure.axes[n]`` will be returned, default is ``False``</span>
<span class="sd">          * axnum (int): axes index on which to plot, default is ``None`` (create new ax)</span>
<span class="sd">          * retfig (bool): if ``True``, the figure object will be returned, default is ``False``</span>
<span class="sd">          * fig (figure): figure object on which to plot, default is ``None`` (use fignum)</span>
<span class="sd">          * retax (bool): if ``True``, the ax will be returned, default is ``False``</span>
<span class="sd">          * ax (axes): ax on which to plot, default is ``None``</span>
<span class="sd">          * now (bool): if ``True`` and within range, a vertical line as indication of &quot;now&quot; will be shown, default is True</span>
<span class="sd">          * retnow (bool): returns the line object (``nowline`` key) corresponding to the &#39;now-line&#39;, default is ``False``</span>
<span class="sd">          * legend (bool): whether to add a legend or not, default is ``True``</span>
<span class="sd">          * loc: location of the legend, default is 8 (top right), refer to plt.legend</span>
<span class="sd">          * ncol: number of columns in the legend, default is 3, refer to plt.legend</span>
<span class="sd">          * columnspacing: spacing between columns in the legend, refer to plt.legend</span>
<span class="sd">          * lfs: legend font size, default is 11</span>
<span class="sd">          * textlbl (bool): if ``True``, a text label with target name or coordinates will be added near transit, default is ``False``</span>
<span class="sd">          * polar (bool): if ``True``, plots the sky view, otherwise plots target attribute versus time</span>
<span class="sd">          * time (str): the type of the x-axis time, ``ut`` for UT, ``loc`` for local time and ``lst`` [0-24] for local sidereal time, default is ``ut`` (not with polar mode)</span>

<span class="sd">        Raises:</span>
<span class="sd">          N/A</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_core</span><span class="o">.</span><span class="n">NOPLOT</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_exc</span><span class="o">.</span><span class="n">raiseIt</span><span class="p">(</span><span class="n">_exc</span><span class="o">.</span><span class="n">NoPlotMode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raiseError</span><span class="p">):</span> <span class="k">return</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;fignum&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;fig&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;axnum&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ax&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># no fig and no ax given, need to create</span>
            <span class="n">thefig</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;fignum&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">thefig</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fignum&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;fig&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ax&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">thefig</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thefig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;axnum&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ax&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;polar&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">theax</span> <span class="o">=</span> <span class="n">thefig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">theax</span> <span class="o">=</span> <span class="n">thefig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;axnum&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">theax</span> <span class="o">=</span> <span class="n">thefig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">theax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span>
        <span class="n">retkwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;retfignum&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span> <span class="n">retkwargs</span><span class="p">[</span><span class="s">&#39;fignum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thefig</span><span class="o">.</span><span class="n">number</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;retaxnum&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span> <span class="n">retkwargs</span><span class="p">[</span><span class="s">&#39;axnum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thefig</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">theax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;retfig&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span> <span class="n">retkwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thefig</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;retax&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span> <span class="n">retkwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">theax</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;simpleplt&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">retkwargs</span><span class="o">!=</span><span class="p">{}:</span>
                <span class="k">return</span> <span class="n">retkwargs</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;polar&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">axlim</span> <span class="o">=</span> <span class="mi">90</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon_obs</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ymin_margin&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
            <span class="n">_core</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;S&quot;</span><span class="p">])</span>
            <span class="n">_core</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;E&quot;</span><span class="p">])</span>
            <span class="n">theax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">axlim</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;O&#39;</span><span class="p">)</span>
            <span class="n">_core</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">theax</span><span class="p">)</span>
            <span class="n">theax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">axlim</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">&#39;#B3B3B3&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
            <span class="n">theax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="mi">90</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon_obs</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">alt</span> <span class="ow">in</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon_obs</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
                <span class="n">theax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="mi">90</span><span class="o">-</span><span class="n">alt</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;dotted&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">alt</span><span class="o">==</span><span class="mi">90</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">theax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">89</span><span class="o">-</span><span class="n">alt</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">alt</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">az</span> <span class="ow">in</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">theax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">axlim</span><span class="o">*</span><span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">az</span><span class="p">),</span> <span class="o">-</span><span class="n">axlim</span><span class="o">*</span><span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">az</span><span class="p">)],</span> <span class="p">[</span><span class="n">axlim</span><span class="o">*</span><span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">az</span><span class="p">),</span> <span class="o">-</span><span class="n">axlim</span><span class="o">*</span><span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">az</span><span class="p">)],</span> <span class="s">&#39;k:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">n</span><span class="p">,</span> <span class="n">radii</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="p">[</span><span class="n">axlim</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">xs</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">radii</span><span class="p">,</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">radii</span><span class="p">,</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
            <span class="n">xs</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="mi">1</span><span class="p">,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ys</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">ys</span><span class="p">[</span><span class="mi">1</span><span class="p">,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">theax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">ys</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
            <span class="n">theax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">axlim</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">301</span><span class="p">))</span>
            <span class="n">theax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">90</span><span class="o">-</span><span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="s">&#39;k*&#39;</span><span class="p">)</span>
            <span class="n">theax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="n">axlim</span><span class="p">,</span><span class="n">axlim</span><span class="p">])</span>
            <span class="n">theax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="n">axlim</span><span class="p">,</span><span class="n">axlim</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># set min and max on y axis to most min and most max of any plot-able parameter, or ylim</span>
            <span class="n">minmin</span><span class="p">,</span> <span class="n">maxmax</span> <span class="o">=</span> <span class="n">theax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ylim&#39;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">360</span><span class="p">]))</span>
            <span class="c"># if polar night</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sunrise</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunset</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;alwaysDark&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">bgcolor</span> <span class="o">=</span> <span class="s">&#39;w&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bgcolor</span> <span class="o">=</span> <span class="s">&#39;#04031C&#39;</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;dt&#39;</span><span class="p">,</span> <span class="mf">1.</span><span class="p">))</span>
            <span class="c"># set up t0 default</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunrise</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunsetastro</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">start_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunsetastro</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunsetnautical</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">start_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunsetnautical</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunsetcivil</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">start_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunsetcivil</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">start_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunset</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c"># set up t0</span>
            <span class="n">lst1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lst</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lst</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">lst1</span> <span class="o">+=</span> <span class="mi">24</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">!=</span><span class="s">&#39;lst&#39;</span><span class="p">:</span>
                <span class="n">t0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;t0&#39;</span><span class="p">,</span> <span class="n">start_default</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lst</span><span class="p">[:</span><span class="mi">4</span><span class="p">]))</span><span class="o">*</span><span class="p">(</span><span class="n">start_default</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">t0lst</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;t0&#39;</span><span class="p">,</span> <span class="n">start_default</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">lst1</span><span class="p">)</span>
                <span class="n">t0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">t0lst</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lst</span><span class="p">[:</span><span class="mi">4</span><span class="p">]))</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c"># prepare x-axis and ticks</span>
            <span class="n">xaxisvalues</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">dt</span><span class="o">/</span><span class="mf">24.</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dt</span><span class="o">/</span><span class="mf">24.</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]]</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s">&#39;loc&#39;</span><span class="p">:</span>
                <span class="n">xaxisvaluesstr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">item</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">localTimeOffest</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">xaxisvalues</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;retxdisp&#39;</span><span class="p">,</span> <span class="s">&#39;False&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span> <span class="n">retkwargs</span><span class="p">[</span><span class="s">&#39;xdisp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">localTimeOffest</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">localTimeOffest</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s">&#39;lst&#39;</span><span class="p">:</span>
                <span class="n">dtlst</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="n">lst1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">24.</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">lst</span> <span class="o">=</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t0lst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">dtlst</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">_core</span><span class="o">.</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t0lst</span><span class="p">,</span> <span class="n">lst1</span><span class="p">,</span> <span class="n">dtlst</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]]</span>
                <span class="n">xaxisvaluesstr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">))</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">item</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span><span class="p">))</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;retxdisp&#39;</span><span class="p">,</span> <span class="s">&#39;False&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span> <span class="n">retkwargs</span><span class="p">[</span><span class="s">&#39;xdisp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lst1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>            
                <span class="n">xaxisvaluesstr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">item</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">xaxisvalues</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;retxdisp&#39;</span><span class="p">,</span> <span class="s">&#39;False&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span> <span class="n">retkwargs</span><span class="p">[</span><span class="s">&#39;xdisp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;UT&#39;</span>
            <span class="c"># prepare background</span>
            <span class="n">theax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">minmin</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">maxmax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">bgcolor</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">bgcolor</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunrise</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">theax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sunset</span><span class="p">,</span> <span class="n">minmin</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunrise</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">sunset</span><span class="p">,</span> <span class="n">maxmax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;#1814A3&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;#1814A3&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunsetcivil</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunrisecivil</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">theax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sunsetcivil</span><span class="p">,</span> <span class="n">minmin</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunrisecivil</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">sunsetcivil</span><span class="p">,</span> <span class="n">maxmax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;#6F6BE8&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;#6F6BE8&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunsetnautical</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunrisenautical</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">theax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sunsetnautical</span><span class="p">,</span> <span class="n">minmin</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunrisenautical</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">sunsetnautical</span><span class="p">,</span> <span class="n">maxmax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;#C1BFF2&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;#C1BFF2&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunsetastro</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunriseastro</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">theax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sunsetastro</span><span class="p">,</span> <span class="n">minmin</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sunriseastro</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">sunsetastro</span><span class="p">,</span> <span class="n">maxmax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">))</span>
            <span class="n">theax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;xlim&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]))</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;ylim&#39;</span><span class="p">):</span>
                <span class="n">theax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ylim&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">theax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon_obs</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ymin_margin&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span> <span class="mi">90</span><span class="p">])</span>
                <span class="n">theax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">_core</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">minmin</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon_obs</span><span class="o">-</span><span class="n">minmin</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">))</span>
            <span class="n">_core</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xaxisvalues</span><span class="p">,</span> <span class="n">xaxisvaluesstr</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">)</span>
            <span class="n">theax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">theax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s">&#39;Time (&#39;</span><span class="o">+</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">,</span> <span class="s">&#39;UT&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">))</span>
            <span class="n">theax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ylabel&#39;</span><span class="p">,</span> <span class="s">&#39;Elevation ()&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;now&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">nowArg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">thenowline</span> <span class="o">=</span> <span class="n">theax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">_core</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">now</span><span class="p">()],</span> <span class="n">theax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="s">&#39;r-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thenowline</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">theax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">))</span><span class="o">+</span><span class="s">&#39; - &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">localnight</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;retnow&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;polar&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span> <span class="n">retkwargs</span><span class="p">[</span><span class="s">&#39;nowline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">thenowline</span><span class="p">]</span> <span class="c"># if polar, we get the nowline from each item</span>
        <span class="k">if</span> <span class="n">retkwargs</span><span class="o">!=</span><span class="p">{}:</span> <span class="k">return</span> <span class="n">retkwargs</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.3</a>
      
    </div>

    

    
  </body>
</html>